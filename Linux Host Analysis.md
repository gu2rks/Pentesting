## Machine

### Distribution
```console
$ cat /etc/*-release
$ lsb_release -a
$ hostnamectl
```

### Kernelversion
```console
$ uname -a
$ cat /proc/version
```

### Running services
```console
$ systemctl list-unit-files	CentOS/RHEL 7.x 
```

### Find specific files and folders
```console
$ find / -name "*.err" ----- Searching whole drive
$ find . -name "*.err" ----- Searching current drive
```

### Hostname
```console
$ uname -sr | tee $(hostname -s)-os-name-version.txt 
```

### Find installed software

* Aptitude-based distributions (Ubuntu, Debian, etc): dpkg -l
* RPM-based distributions (Fedora, RHEL, etc): rpm -qa
* pkg*-based distributions (OpenBSD, FreeBSD, etc): pkg_info
* Portage-based distributions (Gentoo, etc): equery list or eix -I
* pacman-based distributions (Arch Linux, etc): pacman -Q
* Cygwin: cygcheck --check-setup --dump-only *
* Slackware: slapt-get --installed


### Apache version
```console
$ apache2 -v | tee $(hostname -s)-apache-version.txt
```

### OpenSSH version
```console
$ sshd -V  | tee $(hostname -s)-openssh-version.txt  
```

### MySQL version
```console
$ mysql --version  | tee $(hostname -s)-mysql-version.txt 
```
 		
### Log Analysis
To perform a simple search, enter your search string followed by the file you want to search. Here, we search the authentication log for lines containing “user testuser”.  
```console
$ grep "user testuser" /var/log/auth.log 
```

This is a regex that only returns instances of 4792 preceded by “port” and an empty space. This can be handy when filtering ports
```console
$ grep -P "(?<=port\s)4792" /var/log/auth.log
```

#### Surround Search
The -B flag specifies how many lines to return before the event, and the -A flag specifies the number of lines after.
grep -B 3 -A 2 'testuser' /var/log/auth.log

#### Cut
The cut command allows you to parse fields from delimited logs. Delimiters are characters like equal signs or commas that break up fields or key-value pairs.  
Let’s say we want to parse the user from this log:  

pam_unix(su:auth): authentication failure; logname=testuser uid=1000 euid=0 tty=/dev/pts/0 ruser=hoover rhost=  user=root  

We can use the cut command like this to get the eighth match. It will be the character after the eight "=" sign.  
```console
$ grep "authentication failure" /var/log/auth.log | cut -d '=' -f 8
root
```

#### Awk
Awk is a powerful command line tool that provides a complete scripting language. For example, let’s say we want to extract the username from all failed login attempts. Our logs have the following format.  

Mar 24 08:28:18 ip-172-31-11-241 sshd[32701]: input_userauth_request: invalid user guest [preauth]  

Here’s how you can use the awk command. First, we use the regular expression /sshd.*invalid user/ to match the sshd invalid user lines. Then print the ninth field using the default delimiter (a space character) using { print $9 }. This outputs the usernames.  

```console
$ awk '/sshd.*invalid user/ { print $9 }' /var/log/auth.log  
guest 
```
## Users and Groups
### Find users
```console
less /etc/passwd
```
### Find files/directories owned by certain groups or users
```console
find . -group {group-name} -name {file-name}
find . -user {group-name} -name {file-name}
```
### List the the users sudo privileges
```console
sudo -l
```
If an editor such as nano has sudo privileges we can do the following:
```console
sudo /bin/nano /opt/priv 
#Now, that you have nano running as root. Press CTR+ R (Read File) root/root.txt
```
