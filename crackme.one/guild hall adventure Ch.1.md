# Guild Hall Adventure 

## Chapter 1
Running the executable will require a greeting phrase without the program won't continue to execute. Polite as we are I passed the parameter "hello" which worked. *I first thought I had to google english medieval greetings but this was nice.*  

Next we are asked why we are here. I tried: food, brains, adventure, ... without success so I decided to fire up GHIDRA and radare2.  
In GHIDRA I saw the following main function:
```c
undefined8 main(int param_1,char **param_2)

{
  int iVar1;
  undefined8 uVar2;
  size_t __n;
  long in_FS_OFFSET;
  code *local_a0;
  char local_98 [136];
  long local_10;
  
  local_10 = *(long *)(in_FS_OFFSET + 0x28);
  if (param_1 == 2) {
    __n = strlen(param_2[1]);
    if (__n == 5) {
      iVar1 = strncmp(param_2[1],"hello",5);
      if (iVar1 == 0) {
        puts("Friendly greetings to you, hacker from another world !");
        printf("So, why are you here ? : ");
        __isoc99_scanf(&DAT_00100a89,local_98);
        printf("%s ?  ",local_98);
        __n = strlen(local_98);
        iVar1 = strncmp(*param_2,local_98,__n);
        if (iVar1 == 0) {
          puts("good, good, welcome to the guild hall!");
          uVar2 = 0;
        }
        else {
          puts(
              "This is the guild hall, i can\'t let you in, sorry, i need to kill you now. Byyye~~~"
              );
          (*local_a0)();
          uVar2 = 0xfffffffd;
        }
        goto LAB_00100967;
      }
    }
    puts("no no no ! it\'s not a socially appropriate greeting !");
    uVar2 = 0xfffffffe;
  }
  else {
    puts("Woaaa ! what about being polite ? huh ?");
    uVar2 = 0xffffffff;
  }
LAB_00100967:
  if (local_10 != *(long *)(in_FS_OFFSET + 0x28)) {
                    /* WARNING: Subroutine does not return */
    __stack_chk_fail();
  }
  return uVar2;
}
```
Everything is quite straigh forward. We only have to find the value our input is compared to. This happens in the following part:
```c
iVar1 = strncmp(*param_2,local_98,__n);
if (iVar1 == 0) {
  puts("good, good, welcome to the guild hall!");
  uVar2 = 0;
}
```
We can see in the code that \*param_2 is not modified above so I decided to fire up radare2 for debugging.
```

|     |||   0x55785f335900      488b8550ffff.  mov rax, qword [local_b0h] ; Store value of local_b0h in rax
|     |||   0x55785f335907      488b00         mov rax, qword [rax]
|     |||   0x55785f33590a      488d8d70ffff.  lea rcx, qword [local_90h] ; Store value of local_90h in rcx
|     |||   0x55785f335911      4889ce         mov rsi, rcx
|     |||   0x55785f335914      4889c7         mov rdi, rax
|     |||   0x55785f335917      e864fdffff     call sym.imp.strncmp    ; int strncmp(const char *s1, const char *s2, size_t n)
|     |||   0x55785f33591c      85c0           test eax, eax
|    ,====< 0x55785f33591e      7415           je 0x55785f335935

....

[0x55785f3357fa]> db 0x55785f33591c ; Setting breakpoint just before the JE instruction to be able to compare values that are             being held by registers and the stack.

[0x55785f3357fa]> dc                ; Run the program
Friendly greetings to you, hacker from another world !
So, why are you here ? : aaaa       ; dummy input
hit breakpoint at: 55785f33591c
[0x55785f33591c]> .afvd local_b0h   ; check the local variable that holds the passphrase
0x7ffd8e632c30  0x00007ffd8e632dc8   .-c..... @rsp stack R W 0x7ffd8e6344ad -->  rdi stack R W 0x746e657664612f2e (./adventure) -->  ascii ; OH! It's "./adventure" 
[0x55785f33591c]> .afvd local_90h   ; check the local variable that holds our input 
0x7ffd8e632c50  0x0000000061616161   aaaa.... @rsi ascii ; we can see our 'aaaa'
[0x55785f33591c]> 
```
So I tried "./adventure" instead of adventure and voil√° :)
```console
ding@dong:~./adventure hello
Friendly greetings to you, hacker from another world !
So, why are you here ? : ./adventure
./adventure ?  good, good, welcome to the guild hall!
```
Guess we have to execute (go onto) our adventure !  

I really liked the text adventure style of this one :)  

Thanks for the challenge **ker2x** !
